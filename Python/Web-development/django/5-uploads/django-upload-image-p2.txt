

DJANGO: HOW TO UPLOAD IMAGE FILES (IN A MORE CUSTOMIZABLE WAY, PART 2/2)


    PRE) Make sure you already prepared your Django:
        /Python/Web-development/django/5-uploads/django-upload-image-p1.txt


    1) To simplify and even expand the form upload possibilities, let's create a Django model (but without to store images in the db [aweful for db performance]):

        1.1) Go to your app models.py file and:

            E.g.
                class UserProfile(models.Model):
                    #...
                    avatar = models.ImageField(upload_to='avatars')  # avatars is the folder in media folder!
                        # Other model options for media files:
                            # models.FileField(), automatic rename the file if duplicated upload;
                            # models.ImageField(), same of FileField but with basic image checks;

        1.2) Run makemigrations and migrate!
        
    
    3) Creating the custom form using Django:

        3.1) In your sub-app folder, create the 'forms.py' file if it doesn't exist yet:

            E.g.
                from django import forms
                class ProfileForm(forms.Form):
                    user_image = forms.ImageField()  # It forces browser to accept only images here.


        3.2) After that, go in the form template itself (html), and replace all form inputs by the form template-variable (double curly-braces {{ }}):

            {% csrf_token %}
            {{ form }} <!-- You'll define 'form' var in views.py in the next step! -->
            <button>Save</button>


    4) Based on the previous roadmap for Django upload (PRE step), let's convert the view manual logic to dynamic Django one. So in views.py, instanciate the form in the get method, and set the new post method configuration:

        E.g.
            #...
            from .forms import ProfileForm
            from .models import UserProfile

            class CreateProfileView(View):
                def get(self, request):
                    form = ProfileForm()
                    return render(
                        request, "profiles/create_profile.html",
                        { "form": form }
                    )

                def post(self, request):
                    submitted_form = ProfileForm(request.POST, request.FILES)
                                    # This 'request' object has properties like: 
                                    # .POST: access to all sent non-file data from form;
                                    # .FILES: access to uploaded file (dictionary) from form;
                    # If everything alright, save the image and return to sub-app home:
                    if submitted_form.is_valid():
                        # Accessing 'avatar' named file from incoming form files:
                        profile = UserProfile(avatar=request.FILES["user_image"])
                        # Saving the file path only (not the file itself) in the db:
                        profile.save()
                        return HttpResponseRedirect("/profiles")

                    # Otherwise, load the form page again w/ the same data used in the previous go:
                    return render(request, "profiles/create_profile.html", {"form": submitted_form})


    
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 


EXTRA INFO: CONTEXT PROCESSORS

    If you want to use {{ MEDIA_URL }} in your templates, add 'django.template.context_processors.media' in the 'context_processors' option of TEMPLATES.